<!--
 ~  This file is part of the Jikes RVM project (http://jikesrvm.org).
 ~
 ~  This file is licensed to You under the Eclipse Public License (EPL);
 ~  You may not use this file except in compliance with the License. You
 ~  may obtain a copy of the License at
 ~
 ~      http://www.opensource.org/licenses/eclipse-1.0.php
 ~
 ~  See the COPYRIGHT.txt file distributed with this work for information
 ~  regarding copyright ownership.
 -->
<project name="openjdk" default="build" basedir=".">

	<import file="base.xml"/>
	<property file="${components.file}"/>

	<property name="openjdk.description" value="openjdk"/>
	
	<property name="openjdk.component.dir" location="${components.dir}/openjdk"/>
	<property name="openjdk.package.dir" value="${openjdk.component.dir}/1.0"/>
	<property name="openjdk.dir" value="${openjdk.package.dir}/openjdk"/>

  <!-- **************************************************************************** -->
  <!-- *                                                                          * -->
  <!-- *               Downloading and installing Openjdk component             * -->
  <!-- *                                                                          * -->
  <!-- **************************************************************************** -->

  <!-- init properties for downloading openjdk from git repository or from web -->	

  <target name="init-openjdk-properties" depends="prepare-ant-tasks">
    <condition property="openjdk.from-web" value="true">
      <and>
        <not>
          <isset property="openjdk.from-git"/>
        </not>
        <not>
          <isset property="openjdk.from-web"/>
        </not>
        <or>
          <not>
            <available file="${openjdk.package.dir}/openjdk/README"/>
          </not>
          <isset property="openjdk.force-download"/>
        </or>
      </and>
    </condition>
  </target>

  <!-- download openjdk from git -->
  <target name="get-openjdk-from-git" depends="init-openjdk-properties" if="openjdk.from-git">
    <test-file name="git.exe" location="${host.file}"/>
    <mkdir dir="${openjdk.package.dir}"/>
    <delete dir="${openjdk.package.dir}/openjdk"/>
    <exec executable="${git.exe}" failonerror="true" dir="${openjdk.package.dir}">
      <arg value="clone"/>
      <arg value="https://github.com/lalitpras/OpenJDKTesting"/>
    </exec>
  </target>

  <!-- download openjdk from web -->
  <target name="get-openjdk-from-web" depends="init-openjdk-properties" if="openjdk.from-web">
    <test-file name="tar.exe" location="${host.file}"/>
    <property name="openjdk.web-archive" value="openjdk-1.0.tar.gz"/>
    <mkdir dir="$openjdk.package.dir}"/>
  </target>

  <target name="fetch" depends="get-openjdk-from-git"/>

  <!-- build openjdk in openjdk.dir -->
  <target name="build" depends="fetch" description="Download Openjdk and build.">
	<exec executable="${openjdk.dir}/autogen.sh" failonerror="true" dir="${openjdk.dir}"/>

	<test-file name="make.exe" location="${host.file}"/>

  <target name="ensure" depends="prepare-ant-tasks">
	<ensureUptodate name="openjdk" dir="${openjdk.package.dir}/${target.name}/lib"/>
  </target>

</project>
